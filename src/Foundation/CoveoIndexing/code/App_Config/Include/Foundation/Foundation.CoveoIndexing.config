<configuration 
  xmlns:patch="http://www.sitecore.net/xmlconfig/">
  <sitecore>
    <pipelines>
      <coveoPostItemProcessingPipeline>
        <processor type="Coveo.SearchProvider.Processors.HtmlContentInBodyWithRequestsProcessor, Coveo.SearchProviderBase">
          <StartCommentText>BEGIN NOINDEX</StartCommentText>
          <EndCommentText>END NOINDEX</EndCommentText>
        </processor>
      </coveoPostItemProcessingPipeline>
      <coveoInboundFilterPipeline>
        <processor type="Sitecore.Foundation.CoveoIndexing.ExcludeVideoFiles, Sitecore.Foundation.CoveoIndexing" />
        <processor type="Sitecore.Foundation.CoveoIndexing.ExcludeImageFiles, Sitecore.Foundation.CoveoIndexing" />
        <processor type="Coveo.SearchProvider.CoveoInboundFilters.HasLayoutInboundFilter, Coveo.SearchProviderBase"></processor>
      </coveoInboundFilterPipeline>
      <coveoResolveItemSite>
        <processor type="Sitecore.Foundation.CoveoIndexing.Processors.ResolveItemSiteProcessor, Sitecore.Foundation.CoveoIndexing" patch:instead="processor[@type='Coveo.SearchProvider.Processors.ResolveItemSiteProcessor, Coveo.SearchProviderBase']"/>
      </coveoResolveItemSite>
    </pipelines>
    <coveo>
      <defaultIndexConfiguration>
        <fieldMap type="Coveo.SearchProvider.CoveoFieldMap, Coveo.SearchProvider">
          <fieldNames hint="raw:AddFieldByFieldName">
            <fieldType fieldName="metakeywords" isSortable="true" isExternal="true" isMultiValue="true" settingType="Coveo.Framework.Configuration.FieldConfiguration, Coveo.Framework" />
            <fieldType fieldName="title" isFacet="true" settingType="Coveo.Framework.Configuration.FieldConfiguration, Coveo.Framework" />
          </fieldNames>
          <externalFields hint="raw:AddExternalField">
            <field fieldName="syslanguage"/>
            <field fieldName="sysfiletype"/>
            <field fieldName="date"/>
          </externalFields>
        </fieldMap>
        <documentOptions>
          <fields hint="raw:AddComputedIndexField">
            <field fieldName="pageicon" sourceField="image">Coveo.SearchProvider.ComputedFields.ImageUrlComputedField, Coveo.SearchProviderBase</field>
            <field fieldName="metakeywords" sourceField="metaKeywords" referencedFieldName="keyword">Coveo.SearchProvider.ComputedFields.ReferencedFieldComputedField, Coveo.SearchProviderBase</field>
          </fields>
          <excludeField hint="list:AddExcludedField">
            <__FinalRenderings>{04BF00DB-F5FB-41F7-8AB7-22408372A981}</__FinalRenderings>
          </excludeField>
        </documentOptions>
        <siteName>habitat</siteName>
      </defaultIndexConfiguration>
      <contentSearch>
        <configuration>
          <indexes hint="list:AddIndex">
            <index id="Coveo_master_index_Habitat" type="Coveo.SearchProvider.ProviderIndex, Coveo.SearchProvider" patch:before = "*[1]">
              <param desc="p_Name">$(id)</param>
              <configuration ref="coveo/defaultIndexConfiguration">
                <pushPermissionsOnRebuild>true</pushPermissionsOnRebuild>
                <queryConfiguration ref="coveo/defaultIndexConfiguration/queryConfiguration">
                  <maximumAge>00:00:00</maximumAge>
                </queryConfiguration>
              </configuration>
              <locations hint="list:AddCrawler">
                <crawler name="ContentCrawler" type="Sitecore.ContentSearch.SitecoreItemCrawler, Sitecore.ContentSearch">
                  <database>master</database>
                  <root>/sitecore/content/Habitat</root>
                  <stopOnError>true</stopOnError>
                </crawler>
              </locations>
              <strategies hint="list:AddStrategy">
                <strategy ref="contentSearch/indexConfigurations/indexUpdateStrategies/coveoSyncMaster"/>
              </strategies>
              <propertyStore ref="contentSearch/indexConfigurations/databasePropertyStore" param1="$(id)"/>
              <enableItemLanguageFallback>false</enableItemLanguageFallback>
              <enableFieldLanguageFallback>false</enableFieldLanguageFallback>
            </index>
            <index id="Coveo_web_index_Habitat" type="Coveo.SearchProvider.ProviderIndex, Coveo.SearchProvider" patch:before = "*[2]">
              <param desc="p_Name">$(id)</param>
              <configuration ref="coveo/defaultIndexConfiguration" />
              <locations hint="list:AddCrawler">
                <crawler name="ContentCrawler" type="Sitecore.ContentSearch.SitecoreItemCrawler, Sitecore.ContentSearch">
                  <database>web</database>
                  <root>/sitecore/content/Habitat</root>
                  <stopOnError>true</stopOnError>
                </crawler>
              </locations>
              <strategies hint="list:AddStrategy">
                <strategy ref="contentSearch/indexConfigurations/indexUpdateStrategies/coveoOnPublishEndAsync"/>
              </strategies>
              <propertyStore ref="contentSearch/indexConfigurations/databasePropertyStore" param1="$(id)"/>
              <enableItemLanguageFallback>false</enableItemLanguageFallback>
              <enableFieldLanguageFallback>false</enableFieldLanguageFallback>
            </index>
          </indexes>
        </configuration>
      </contentSearch>
    </coveo>
  </sitecore>
</configuration>